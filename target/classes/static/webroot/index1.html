<html style="height: auto; min-height: 100%;">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Logistic Realtime Tracking</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="./assets/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="./assets/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="./assets/ionicons.min.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="./assets/jquery-jvectormap.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="./assets/AdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="./assets/_all-skins.min.css">
  <link rel="stylesheet" href="./assets/site.css">


  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="./assets/css">

</head>

<body class="skin-blue sidebar-mini" style="height: auto; min-height: 100%;">
  <div class="wrapper" style="height: auto; min-height: 100%;">

    <header class="main-header">
      <nav class="navbar navbar-static-top">
      </nav>
    </header>


    <div class="content-wrapper">
      <section class="content">
        <div class="row">
          <div class="col-md-8">

            <div class="box box-success">
              <div class="box-header with-border headerStyle">
                <h3 class="box-title">Geolocation</h3>
              </div>
              <div class="box-body no-padding">
                <div class="row">
                  <div class="col-md-12">

                    <div id="map" style="width: 100%; height: 330px;"></div>
                  </div>
                </div>
              </div>

            </div>

            <div class="box box-success">
              <div class="box-header with-border headerStyle">
                <h3 class="box-title">Humidity Temperature & Speed</h3>
              </div>
              <div class="box-body no-padding">
                <div class="row">
                  <div class="col-md-12">
                    <div id="alertGraph">
                      <div id="legend" class="legend"></div>
                      <br>
                      <svg width="800" height="220" id="chart"></svg>
                    </div>
                    <div class="loader" style="width:810px;height:220px;padding-top:10px">
                      <div class="spinner">
                        <div class="double-bounce1"></div>
                        <div class="double-bounce2"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-4">

            <div class="box box-default">
              <div class="box-header with-border headerStyle">
                <h3 class="box-title">Driver Profile</h3>

              </div>
              <div class="box-body">
                <div class="row">
                  <div class="col-md-12">

                    <div class="row">
                      <div class="col-xs-12 col-sm-4 center">
                        <span class="profile-picture">
                          <img class="editable img-responsive" alt=" Avatar" id="avatar" src="/images/Driver3.jpg">
                        </span>
                        <div class="space space-5"></div>
                      
                        <a href="#" class="btn btn-sm btn-block btn-primary">
                          Send a message
                        </a>
                      </div>
                      <div class="col-xs-12 col-sm-8">
                        <h4 class="blue">
                          <span class="middle userName">John Doe</span>

                        </h4>
                        <div class="profile-user-info">
                          <div class="profile-info-row">
                            <div class="profile-info-name "> Username </div>
                            <div class="profile-info-value">
                              <span class="userName">John Doe</span>
                            </div>
                          </div>

                          <div class="profile-info-row">
                            <div class="profile-info-name"> Age </div>
                            <div class="profile-info-value">
                              <span id="age">30</span>
                            </div>
                          </div>
                          <div class="profile-info-row">
                            <div class="profile-info-name"> Joined </div>
                            <div class="profile-info-value">
                              <span id="joinedOn">2010/06/20</span>
                            </div>
                          </div>
                          <div class="profile-info-row">
                            <div class="profile-info-name"> Vehicle Number </div>
                            <div class="profile-info-value">
                              <span id="vehicleNo">UP32 hy 666</span>
                            </div>
                          </div>
                        </div>
                        <div class="hr hr-8 dotted"></div>

                      </div>
                    </div>

                  </div>

                </div>

                <div class="box-footer no-padding">

                </div>
              </div>
            </div>
            <div class="box box-primary">
              <div class="box-header with-border headerStyle">
                <h3 class="box-title">Vehicle Container Humidaity(%)</h3>
              </div>

              <div class="box-body">
                <div class="row">
                  <div class="col-md-12">

                    <div class="direct-chat-messages">
                      <div class="Chart">

                        <div id="humidityChart"></div>

                      </div>
                      <div class="loader">
                        <div class="spinner">
                          <div class="double-bounce1"></div>
                          <div class="double-bounce2"></div>
                        </div>
                      </div>
                    </div>


                  </div>

                </div>

                <div class="box-footer no-padding">

                </div>
              </div>
            </div>

            <div class="box box-primary">
              <div class="box-header with-border headerStyle">
                <h3 class="box-title">Alert Chart</h3>
              </div>

              <div class="box-body">
                <div class="row">
                  <div class="col-md-12">

                    <div class="table-responsive" style="overflow-x: hidden;">
                      <table class="table no-margin" id="alertChart">
                        <thead>
                          <tr>
                            <th>Type</th>
                            <th>Value</th>
                            <th>Threashold</th>
                            <th>Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>Humidity(%)
                            </td>
                            <td id='rHumid'></td>
                            <td>
                              10-20
                            </td>
                            <td><span class="label label-success" id="hStatus">Normal</span></td>
                          </tr>
                          <tr>
                            <td>Temperature(C)
                            </td>
                            <td id='rTemp'> </td>

                            <td>
                              25-35
                            </td>
                            <td><span class="label label-warning" id="tStatus">Edge</span></td>
                          </tr>
                          <tr>
                            <td>Speed(M/H)
                            </td>
                            <td id='rSpeed'></td>
                            <td>
                              0-60
                            </td>
                            <td><span class="label label-danger" id="sStatus">Exceed</span></td>
                          </tr>

                        </tbody>
                      </table>
                      <div class="loader" style="height: 200px;">
                        <div class="spinner">
                          <div class="double-bounce1"></div>
                          <div class="double-bounce2"></div>
                        </div>
                      </div>


                    </div>


                  </div>

                </div>

                <div class="box-footer no-padding">

                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <input type="hidden" id="vehicleId" value="1">
    </div>

    <footer class="main-footer">
      <div class="pull-right hidden-xs">
        <b>Version</b> 1.0.0
      </div>
      <strong>Copyright Â© 2018-2019 Real time tracking All rights
        reserved.
    </footer>

  </div>
  <!-- ./wrapper -->

  <!-- jQuery 3 -->
  <script src="./assets/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="./assets/bootstrap.min.js"></script>
  <!-- FastClick -->
  <script src="./assets/fastclick.js"></script>
  <!-- AdminLTE App -->
  <script src="./assets/adminlte.min.js"></script>
  <!-- Sparkline -->
  <script src="./assets/jquery.sparkline.min.js"></script>
  <!-- jvectormap  -->
  <script src="./assets/jquery-jvectormap-1.2.2.min.js"></script>
  <script src="./assets/jquery-jvectormap-world-mill-en.js"></script>
  <!-- SlimScroll -->
  <script src="./assets/jquery.slimscroll.min.js"></script>
  <!-- ChartJS -->
  <script src="./assets/Chart.js"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="./assets/dashboard2.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="./assets/demo.js"></script>
  <script src="./js/commonScript.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkvt057gy7BBc6B1uH_n_Xh0ir3cwIgLk"></script>


  <script src="//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
  <script src="vertxbus.js"></script>
  <script>
    // mean and deviation for time interval
    var meanMs = 1000, // milliseconds
      dev = 150;
    var url = window.location.href
    var arr = url.split("/");
    var domainAddress = arr[0] + "//" + arr[2];
    $('#avatar').attr('src', domainAddress + '/images/Driver3.jpg');


    var time_frame = 10000;
    var sChartHeight = 150;
    var sChartWidth = 360;
    var marginSpeed = 20;
    var duration = 1000;
    var time = Date.now() + duration;
    var start_time = time - (duration * 2) - time_frame;

    var eb = new vertx.EventBus("http://35.209.112.128/" + "eventbus");
    var delay = 1000;
    initializeMap();

    // start the data generator

    var data = [];
    var sData = [];
    // var data = [100, 150, 200, 250, 280, 300];
    /*  var data = [ {creatTime: 0, cpuTime: 00}, {creatTime: 1, cpuTime: 30}, {creatTime: 2, cpuTime: 40},
         {creatTime: 3, cpuTime: 20}, {creatTime: 4, cpuTime: 90}, {creatTime: 5, cpuTime: 70} ]; */
    var margin = {
        top: 20,
        right: 20,
        bottom: 30,
        left: 50
      },
      width = 350 - margin.left - margin.right,
      height = 150 - margin.top - margin.bottom;



    var xScaleSpeed = d3.scaleTime()
      .domain([time + duration, time - (duration * 2) - time_frame])
      //    .domain([time - duration, start_time + duration])
      .range([sChartWidth - (marginSpeed * 2), 0]);

    var yScaleSpeed = d3.scaleLinear()
      .domain([0, 50])
      .range([sChartHeight - (marginSpeed * 2), 0]);

    var xAxis = d3.axisBottom(xScaleSpeed)
      .ticks(4);

    var yAxis = d3.axisRight(yScaleSpeed)
      .ticks(4);

    var svgSpeed = d3.select('#humidityChart')
      .append('svg')
      .attr('width', sChartWidth)
      .attr('height', sChartHeight)
      .append('g');

    svgSpeed.append('g')
      .attr('transform', 'translate(' + (sChartWidth - marginSpeed * 2) + ',' + marginSpeed + ')')
      .classed('y axis', true)
      .call(yAxis);

    svgSpeed.append('g')
      .attr('transform', 'translate(0,' + (sChartHeight - marginSpeed) + ')')
      .classed('x axis', true);

    svgSpeed.append('defs')
      .append('clipPath')
      .attr('id', 'clip')
      .append('rect')
      .attr('width', (sChartWidth - (marginSpeed * 2)))
      .attr('height', (sChartHeight - (marginSpeed * 2)))
      .attr('transform', 'translate(-1.5, 20)');

    svgSpeed.append('g')
      .attr('clip-path', 'url(#clip)')
      .classed('line_', true)
      .append('path')
      .datum(sData)
      .classed('line', true)
      .style('fill', 'none')
      .style('stroke', '#00a65a')
      .style('stroke-width', '1.5px');



    var svg = d3.select("#chart"),
      margin = {
        top: 5,
        right: 5,
        bottom: 50,
        left: 30
      },
      width = Math.floor(svg.attr("width") - margin.left - margin.right),
      height = Math.floor(svg.attr("height") - margin.top - margin.bottom);

    var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    g.append("defs").append("clipPath")
      .attr("id", "clip2")
      .append("rect")
      .attr("x", 0)
      .attr("y", 0)
      .attr("width", width)
      .attr("height", height);

    var parseTime = d3.timeParse("%Y%m%d");

    var x1 = d3.scaleTime().range([0, width]),
      y1 = d3.scaleLinear().range([height, 0]),
      z1 = d3.scaleOrdinal(d3.schemeCategory10);

    y1.domain([0, 100]);


    let dta = [{
        id: "Speed(M/H)",
        values: []
      },
      {
        id: "Temperature(C)",
        values: []
      },
      {
        id: "Humidity(%)",
        values: []
      }

    ];

    z1.domain(dta.map(function (c) {
      return c.id;
    }));

    var x_axis = d3.axisBottom()
      .scale(x1);
    var x_axis_svg = g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .text("time(s)");

    x_axis_svg.call(x_axis);

    g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y1))
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("fill", "#000")
      .text("");

    let pathsG = g.append("g").attr("id", "paths").attr("class", "paths")
      .attr("clip-path", "url(#clip2)");

    let globalX = 0;
    //let duration = 1000; //how quickly to move (will look jerky if less that data input rate)
    let limit = 60; // how many datapoints, total points = (duration * limit)



    eb.onopen = function () {

      eb.registerHandler('loadVehicle', function (msg) {

        //console.log(data);
        if (data.length === 25) {
          // when length of data equal 25 then pop data[0]
          data.shift();
        }
        data.push({
          "eventTime": new Date(msg.eventTime),
          "vehicleHeat": msg.vehicleHeat,
          "vehicleHumidity": msg.vehicleHumidity,
          "vehicleSpeed": msg.vehicleSpeed,
          "vehicleId": msg.vehicleId
        });

        if (msg.vehicleId == $('#vehicleId').val()) {
          $('#rSpeed').html(msg.vehicleSpeed);
          $('#sStatus').removeClass('label-success');
          $('#sStatus').removeClass('label-danger');

          $('#hStatus').removeClass('label-success');
          $('#hStatus').removeClass('label-danger');

          $('#tStatus').removeClass('label-success');
          $('#tStatus').removeClass('label-danger');

          if (inRange(msg.vehicleSpeed, 0, 60)) {
            $('#sStatus').addClass('label-success').html("Normal");
          } else {
            $('#sStatus').addClass('label-danger').html("Exceed");
          }

          if (inRange(msg.vehicleHumidity, 10, 20)) {
            $('#hStatus').addClass('label-success').html("Normal");

          } else {
            $('#hStatus').addClass('label-danger').html("Exceed");
          }

          if (inRange(msg.vehicleHeat, 25, 35)) {
            $('#tStatus').addClass('label-success').html("Normal");
          } else {
            $('#tStatus').addClass('label-danger').html("Exceed");
          }
          $('#rHumid').html(msg.vehicleHumidity);
          $('#rTemp').html(msg.vehicleHeat);


          updateChart(msg);
          updateHumidity(msg);
        }
      });

    };

  </script>
</body>

</html>